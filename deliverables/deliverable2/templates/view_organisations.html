{% extends "base.html" %}

{% block title %}Partner Organisations - Community Connect{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-success text-white">
                <h4 class="card-title mb-0">
                    <i class="fas fa-building me-2"></i>
                    Partner Organisations
                </h4>
                <small class="text-light">READ Operation - Display all organisations from the database</small>
            </div>
            
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-8">
                        <p class="text-muted mb-0">
                            <i class="fas fa-info-circle me-2"></i>
                            Browse our network of partner organisations that coordinate volunteer opportunities 
                            in the Perth community. Each organisation offers unique ways to contribute and make a difference.
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <span class="badge bg-success fs-6">
                            {{ organisations|length }} Organisation{{ 's' if organisations|length != 1 else '' }}
                        </span>
                    </div>
                </div>

                {% if organisations %}
                    {% set type_colors = {
                        'Charity': 'danger',
                        'Community Group': 'primary', 
                        'Non-Profit': 'success',
                        'Government': 'warning',
                        'Educational': 'info'
                    } %}
                    <div class="row">
                        {% for org in organisations %}
                        <div class="col-lg-6 col-xl-4 mb-4">
                            <div class="card h-100 border-0 shadow-sm">
                                <!-- Organisation Type Badge -->
                                <div class="card-header border-0 bg-light">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h6 class="card-subtitle mb-0 text-muted">{{ org.org_type }}</h6>
                                        <span class="badge bg-{{ type_colors.get(org.org_type, 'secondary') }}">
                                            {{ org.org_type }}
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="card-body">
                                    <!-- Organisation Name -->
                                    <h5 class="card-title text-primary">
                                        <i class="fas fa-building me-2"></i>
                                        {{ org.org_name }}
                                    </h5>
                                    
                                    <!-- Description -->
                                    {% if org.description %}
                                    <p class="card-text text-muted small">
                                        {{ org.description }}
                                    </p>
                                    {% endif %}
                                    
                                    <!-- Contact Information -->
                                    <div class="mt-3">
                                        <h6 class="text-muted mb-2">
                                            <i class="fas fa-address-book me-1"></i>
                                            Contact Information
                                        </h6>
                                        
                                        <div class="small">
                                            <!-- Email -->
                                            <div class="d-flex align-items-center mb-1">
                                                <i class="fas fa-envelope text-primary me-2" style="width: 16px;"></i>
                                                <a href="mailto:{{ org.contact_email }}" class="text-decoration-none">
                                                    {{ org.contact_email }}
                                                </a>
                                            </div>
                                            
                                            <!-- Phone -->
                                            <div class="d-flex align-items-center mb-1">
                                                <i class="fas fa-phone text-success me-2" style="width: 16px;"></i>
                                                <a href="tel:{{ org.phone }}" class="text-decoration-none">
                                                    {{ org.phone|phone }}
                                                </a>
                                            </div>
                                            
                                            <!-- Address -->
                                            <div class="d-flex align-items-start">
                                                <i class="fas fa-map-marker-alt text-danger me-2 mt-1" style="width: 16px;"></i>
                                                <span>{{ org.address }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card-footer bg-light border-0">
                                    <div class="d-grid">
                                        <small class="text-muted text-center">
                                            <i class="fas fa-hashtag me-1"></i>
                                            Organisation ID: {{ org.org_id }}
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Summary Statistics -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card bg-light border-0">
                                <div class="card-body">
                                    <h6 class="card-title">
                                        <i class="fas fa-chart-bar me-2"></i>
                                        Organisation Summary
                                    </h6>
                                    
                                    <div class="row text-center">
                                        {% set org_counts = {} %}
                                        {% for org in organisations %}
                                            {% set _ = org_counts.update({org.org_type: org_counts.get(org.org_type, 0) + 1}) %}
                                        {% endfor %}
                                        
                                        {% for org_type, count in org_counts.items() %}
                                        <div class="col-6 col-md-3 col-lg mb-2">
                                            <div class="border-end">
                                                <div class="h4 mb-0 text-{{ type_colors.get(org_type, 'secondary') }}">{{ count }}</div>
                                                <small class="text-muted">{{ org_type }}{{ 's' if count != 1 else '' }}</small>
                                            </div>
                                        </div>
                                        {% endfor %}
                                        
                                        <div class="col-6 col-md-3 col-lg mb-2">
                                            <div class="h4 mb-0 text-primary">{{ organisations|length }}</div>
                                            <small class="text-muted">Total Partners</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                {% else %}
                    <!-- No Organisations Found -->
                    <div class="text-center py-5">
                        <div class="display-1 text-muted mb-3">
                            <i class="fas fa-building"></i>
                        </div>
                        <h4 class="text-muted">No Organisations Found</h4>
                        <p class="text-muted">
                            There are currently no partner organisations registered in the system.
                        </p>
                        <div class="alert alert-info d-inline-block" role="alert">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Database Note:</strong> This could indicate a database connection issue or that 
                            the database hasn't been populated with sample data yet.
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card border-0 shadow-sm mt-4">
            <div class="card-body">
                <h6 class="card-title">
                    <i class="fas fa-bolt me-2"></i>
                    Quick Actions
                </h6>
                <div class="row">
                    <div class="col-md-6 col-lg-3 mb-2">
                        <div class="d-grid">
                            <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
                                <i class="fas fa-home me-2"></i>
                                Back to Dashboard
                            </a>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3 mb-2">
                        <div class="d-grid">
                            <a href="{{ url_for('view_events') }}" class="btn btn-outline-warning">
                                <i class="fas fa-calendar me-2"></i>
                                View Events
                            </a>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3 mb-2">
                        <div class="d-grid">
                            <a href="{{ url_for('view_volunteers') }}" class="btn btn-outline-info">
                                <i class="fas fa-users me-2"></i>
                                View Volunteers
                            </a>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-3 mb-2">
                        <div class="d-grid">
                            <a href="{{ url_for('new_volunteer') }}" class="btn btn-primary">
                                <i class="fas fa-user-plus me-2"></i>
                                Add Volunteer
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Add interactivity for organisation cards
    document.addEventListener('DOMContentLoaded', function() {
        // Add hover effects to organisation cards
        const orgCards = document.querySelectorAll('.card.h-100');
        
        orgCards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-2px)';
                this.style.transition = 'transform 0.2s ease-in-out';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });
        
        // Copy organisation ID to clipboard
        const orgIds = document.querySelectorAll('[data-org-id]');
        orgIds.forEach(element => {
            element.addEventListener('click', function() {
                navigator.clipboard.writeText(this.dataset.orgId).then(() => {
                    // Show temporary tooltip
                    const tooltip = document.createElement('div');
                    tooltip.className = 'position-absolute bg-dark text-white p-1 rounded small';
                    tooltip.textContent = 'ID Copied!';
                    tooltip.style.top = '-30px';
                    tooltip.style.left = '50%';
                    tooltip.style.transform = 'translateX(-50%)';
                    
                    this.style.position = 'relative';
                    this.appendChild(tooltip);
                    
                    setTimeout(() => {
                        tooltip.remove();
                    }, 1500);
                });
            });
        });
    });
</script>
{% endblock %}